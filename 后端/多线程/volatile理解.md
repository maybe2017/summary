### 硬件层面
1. 寄存器、L1、L2缓存 cpu核心各自拥有，L3缓存是多个cpu核心共享。
2. 锁总线 + 锁缓存(MESI缓存一致性协议)

### 缓存行 cache line
1. MESI读写缓存，会以缓存行作为基本单位，缓存行一般为64字节!!
2. 如果一个缓存行中，存有两个数据xy，分别被两个cpu核心使用，那么彼此对xy更新时，MESI协议会导致整个缓存行被重新读，称为 `伪共享`。
3. 解决办法：强制使一个变量存储在一个单独的缓存行中，称为 `缓存行对齐`。
    ```
    1. 构造一个Padding父类，填充7个long型变量。
    2. 目标变量的类，继承Padding类，从而使目标类加载后，目标变量一定在单独一个缓存行。
    3. 或者在目标变量前后，分别填充7个long型变量，保证目标变量一定在单独一个缓存行。
    ```
### cpu执行指令可能是乱序
1. 因为cpu执行速度很快，但是一些指令，如读内存很慢，不可能让cpu等待，此时，cpu就会检测后续的命令是否与当前的命令有依赖性，没有依赖性的话，就可以提前执行。
2. 读命令可以乱序执行，写命令也会合并写入一个4Byte的超高速缓存combineBuffer，然后再写入L1或其他缓存。
3. 如何保证不乱序？CPU级别的内存屏障
    ```


    ```    