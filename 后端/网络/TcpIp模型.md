## TCP/IP模型

### 一、应用层-HTTP、SMTP、SSH

### 二、传输层-TCP、UDP
数据包？
### 三、IP网络层-第4层-路由表-路由判定
IP报文
#### 0.0.0.0 是什么地址？
1. 在服务器中，`0.0.0.0` 是一个特殊的IP地址，它表示本地网络中的所有计算机[局域网]。
2. 在路由表中，`0.0.0.0` 表示的是默认路由，即当路由表中没有找到完全匹配的路由时，数据包会发到目标IP为 `0.0.0.0` 的网关处。
    ```
    // route -n 查询本机路由表
    1. 当本机需要向外部计算机发送数据包时，需要先到此表找到数据包应该给谁
    2. 先用目标域名在dns缓存表或服务器，查询出目标ip地址
    3. 用目标ip地址分别与路由表每一项中的 `子网掩码` 进行&操作，得到结果网络号，看是否与当前路由表项中的 `destination目标地址` 相同，如果相同，就采用当前项的 `gateway网关地址` 作为数据包要发送的地址。【路由判定-按位与】

    // ip网络层的 `下一跳机制`
    1. 互联网机器节点数太多，单个节点不可能存储所有节点的位置，那么发送数据包时，只需要找到当前节点网络的边缘节点即可，边缘节点即 `路由器`，可以实现两个网络的连接。
    2. 数据包到路由器后，由因为路由器也身处一个有边界的网络，它也只需要发送到它可见范围内的边缘节点即可，比如另一个路由器。
    3. 这样传输数据包的时候，不需要考虑最终的目标节点，只需要考虑当前的 `下一跳` 即可。
    ```
3. 路由表中默认存在 掩码为 `0.0.0.0` 这一项，且 `destination目标地址` 也为`0.0.0.0`，即任意目标ip地址，在其他路由项匹配结果不满足的情况下，一定满足这一项，而这一项的 `gateway网关地址` 就成为了兜底的 `下一跳` 地址。即数据包就会走当前机器所在网络的默认网关地址出去。
    ```
    当目标ip地址与子网掩码&的结果匹配到路由表中某一项时，如果该项的 `gateway网关地址` 是`0.0.0.0`，表示目标ip地址为本机局域网的地址。那么数据包的发送就不必走路由器了，直接走交换机即可。
    ```

### 四、数据链路层-ARP表-MAC地址[固定的]-MTU

#### ARP地址解析协议
1. 维护了本机可视网络内，从 IP 地址到 MAC 地址的映射表，即可通过局域网内的目标IP，找到对应的MAC地址。ARP缓存地址会有老化时间，默认是 20 分钟。
2. ARP协议是网络层协议，但是是工作在数据链路层，怎么理解？
    ```
    // 既然数据包带上了IP，那么肯定是网络层协议
    1. 主机A向主机B发送ARP请求报文，其实也就是数据包，数据包头部带有源IP和目标IP，目标IP也就是主机B的IP地址，只有B会收到并且作出回应
    2. 详细点：交换机会先接收到Arp请求，然后会广播转发，此时交换机已经将A的Mac地址记录到Mac表中，主机B收到后会查看数据包首部中的Mac地址，发现不是自己的则会丢弃，主机C收到后进行对比，确认后，会发送一个响应报文，交换机查找Mac表发现有对应关系，便将之转发到主机A，此时也就是是单播。

    ```

    ```
    // 如何工作的？
    1. 本机向外部网络发送数据包时，在网络层找到 `下一跳节点` 时，肯定不能更改数据包中的目标ip地址，那么只能在数据包外层，再套一个Mac地址。于是利用Mac地址可以实现局域网内数据包能正确到达某一节点，比如路由器。
    2. 路由器接收到数据包后，再继续向它可视范围内的下一跳节点转发数据包，那么转发时，变动的就只是接收到的数据包中的Mac地址而已。
    ```
3. ARP只适用于IPv4，不适用于IPv6，IPv6 变成了 NDP。

#### ARP欺骗
1. 局域网中，主机A向主机B发送ARP请求报文，ARP缓存过期后，假设主机B向主机A发送ARP请求报文，两次ARP都是通过交换机广播转发的话，那么C主机这个过程中，就能成功获取A与B的IP地址及MAC地址。
2. 那么C就可以伪造一个ARP请求，将B的IP与自己的MAC映射起来，发送给A主机，A主机就会更新本地的缓存。
3. 那么当A再次向B发送数据包的时候，因为B的IP地址指向了C的MAC地址，最终会发送到C主机。C主机就实现了窃听或更改报文的目的。

#### 交换机
1. 交换机有学习功能，在ARP请求交互过程中，会维护一张 `交换机插口port -> MAC地址` 的映射表。




